# 游빏 API Detector de Mutantes

Este proyecto es una API REST desarrollada en Spring Boot como trabajo pr치ctico integrador, implementando la l칩gica para el desaf칤o de detecci칩n de mutantes de MercadoLibre.

---

## Informaci칩n del Alumno

* **Estudiante:** Nicol치s Vera
* **Legajo:** 51146
* **Materia:** Desarrollo de Software
* **A침o:** 3er A침o

---

## Descripci칩n del Proyecto

La API cumple con los tres niveles del desaf칤o:
1.  **Nivel 1:** Un algoritmo optimizado ($O(N^2)$) para detectar m치s de una secuencia de ADN mutante (horizontal, vertical u oblicua).
2.  **Nivel 2:** Exposici칩n de la l칩gica a trav칠s de endpoints REST (`/mutant` y `/stats`) y documentaci칩n con Swagger.
3.  **Nivel 3:** Persistencia en base de datos H2, deduplicaci칩n de registros usando Hash (SHA-256) y una cobertura de tests superior al 90%.

---

## Arquitectura y Tecnolog칤as Clave

El proyecto est치 construido siguiendo una arquitectura de 6 capas, separando responsabilidades:

* **`config`**: Configuraci칩n de Beans (ej: SwaggerConfig).
* **`controller`**: Recibe las peticiones HTTP (ej: MutantController).
* **`service`**: Contiene toda la l칩gica de negocio (ej: MutantService, StatsService).
* **`repository`**: Define la interfaz con la base de datos (ej: DnaRecordRepository).
* **`entity`**: Modela las tablas de la base de datos (ej: DnaRecord).
* **`dto`**: Define los objetos de transferencia de datos (JSON) (ej: DnaRequest, StatsResponse).
* **`exception`**: Manejo centralizado de errores (ej: GlobalExceptionHandler).
* **`validation`**: L칩gica de validaci칩n personalizada (ej: ValidDnaSequenceValidator).

### Docker
El proyecto incluye un `Dockerfile` que empaqueta la aplicaci칩n en un contenedor liviano listo para producci칩n. Utiliza un **multi-stage build**, compilando el proyecto en una imagen con JDK 21 y luego copiando el `.jar` final a una imagen limpia de `eclipse-temurin:21-jre-alpine`.

**Para construir la imagen de Docker:**
docker build -t mutant-api .


**Para correr el contenedor:**
docker run -p 8080:8080 mutant-api

### PlantUML Diagrama de Arquitectura
Esta herramienta fue utilizada para dise침ar y documentar la arquitectura del proyecto:
```plantuml
@startuml
autonumber
skinparam style strictuml
skinparam sequenceMessageAlign center

actor Cliente as "Cliente (API)"
participant Controller as "MutantController"
participant Service as "MutantService"
participant Detector as "MutantDetector"
participant Repo as "DnaRecordRepository"
database DB as "H2 Database"

box "Application Logic" #LightBlue
    participant Controller
    participant Service
    participant Detector
end box

== 1. Detecci칩n de Mutantes (POST /mutant) ==

Cliente -> Controller: POST /mutant {dna: [...]}
activate Controller

Controller -> Service: analyzeDna(dna)
activate Service

Service -> Service: calculateDnaHash(dna)
Service -> Repo: findByDnaHash(hash)
activate Repo
Repo -> DB: SELECT * WHERE hash = ?
activate DB
DB --> Repo: Resultado
deactivate DB
Repo --> Service: Optional<DnaRecord>
deactivate Repo

alt #LightGreen ADN ya analizado (Cach칠 Hit)
    Service --> Controller: Retorna resultado guardado (boolean)
else #LightYellow ADN Nuevo (Cach칠 Miss)
    Service -> Detector: isMutant(dna)
    activate Detector
    Detector --> Service: boolean (true/false)
    deactivate Detector
    
    Service -> Repo: save(DnaRecord)
    activate Repo
    Repo -> DB: INSERT INTO dna_records...
    activate DB
    DB --> Repo: OK
    deactivate DB
    Repo --> Service: Saved Record
    deactivate Repo
    
    Service --> Controller: Retorna resultado actual
end

alt Es Mutante
    Controller --> Cliente: 200 OK
else Es Humano
    Controller --> Cliente: 403 Forbidden
end

deactivate Service
deactivate Controller

== 2. Consultar Estad칤sticas (GET /stats) ==

Cliente -> Controller: GET /stats
activate Controller

Controller -> Service: getStats()
activate Service

Service -> Repo: countByIsMutant(true)
activate Repo
Repo -> DB: SELECT COUNT...
activate DB
DB --> Repo: Cantidad Mutantes
deactivate DB
Repo --> Service: long countMutant
deactivate Repo

Service -> Repo: countByIsMutant(false)
activate Repo
Repo -> DB: SELECT COUNT...
activate DB
DB --> Repo: Cantidad Humanos
deactivate DB
Repo --> Service: long countHuman
deactivate Repo

Service -> Service: Calcular Ratio

Service --> Controller: StatsResponse
deactivate Service

Controller --> Cliente: 200 OK {JSON}
deactivate Controller

@enduml
```



---

## 游 C칩mo Ejecutar (Instrucciones)

### Requisitos Previos
* Tener instalado **Java JDK 17 o superior** (el proyecto fue desarrollado y probado con JDK 21).

### 1. Clonar el Repositorio
git clone https://github.com/nicofede2509/integrador-Desarrollo-de-Software-Nicol-s-Vera.git cd ExamenMercado


### 2. Ejecutar la Aplicaci칩n
El proyecto incluye un Gradle Wrapper, por lo que no necesit치s tener Gradle instalado.

**En Windows (PowerShell):**
.\gradlew.bat bootRun

**En Mac/Linux:**
./gradlew bootRun

La aplicaci칩n estar치 corriendo en `http://localhost:8080`.

### 3. Ejecutar los Tests
Para correr la suite completa de 32 tests (unitarios y de integraci칩n) y verificar la cobertura de c칩digo:

**En Windows (PowerShell):**
.\gradlew.bat clean test

**En Mac/Linux:**
./gradlew clean test

Si el build termina en **`BUILD SUCCESSFUL`**, significa que todos los tests pasaron y la cobertura de JaCoCo fue superior al 80%.

---

## 游눹 Uso de la API

Una vez que la aplicaci칩n est치 corriendo, pod칠s acceder a los siguientes recursos:

### 1. Documentaci칩n de la API (Swagger)
Para ver todos los endpoints de forma interactiva y probarlos:
* **URL:** `http://localhost:8080/swagger-ui.html` (Link para puerto local)
* **URL:** `https://trabajo-integrador-desarrollo-de-a6l4.onrender.com/swagger-ui/index.html` (Link para p치gina en render, solo cuando est칠 en deploy)

### 2. Consola de la Base de Datos (H2)
Para ver los registros de ADN que se van guardando en la base de datos en memoria:
* **URL:** `http://localhost:8080/h2-console` (Link para puerto local)
* * **URL:** `https://trabajo-integrador-desarrollo-de-a6l4.onrender.com/h2-console` (Link para p치gina en render, solo cuando est칠 en deploy)

**Datos de Conexi칩n:**
* **JDBC URL:** `jdbc:h2:mem:testdb`
* **User Name:** `sa`
* **Password:** (dejar vac칤o)

### 3. Endpoints Principales

#### `POST /mutant`
Analiza una secuencia de ADN.
* **Respuesta `200 OK`:** Si el ADN es mutante.
* **Respuesta `403 Forbidden`:** Si el ADN es humano.
* **Respuesta `400 Bad Request`:** Si el ADN es inv치lido (no es NxN, caracteres inv치lidos, etc.).

#### `GET /stats`
Devuelve las estad칤sticas de los an치lisis realizados.
* **Respuesta `200 OK`:** Devuelve un JSON con los conteos y el ratio.
```json
{
    "count_human_dna": 0,
    "count_mutant_dna": 0,
    "ratio": 0.0
}